name: Debug APK Push

on:
  workflow_dispatch:   # 手动触发

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      # 第一步：拉取仓库
      - name: Checkout FongMi Release repo
        uses: actions/checkout@v3
        with:
          repository: FongMi/Release

      # 第二步：确认目录结构
      - name: Show repo structure
        run: |
          echo "当前目录: $(pwd)"
          ls -R apk/release

      # 第三步：打印找到的 APK 文件路径
      - name: Find APK files
        run: |
          echo "以下是找到的 APK 文件："
          find ./apk/release -name "*.apk"

      # 第四步：测试能否发消息到 Telegram
      - name: Send test message to Telegram
        run: |
          curl -X POST \
            -F chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -F text="✅ Workflow 已经跑起来了！这是调试消息。" \
            ${{ secrets.TELEGRAM_BOT_API_URL }}/sendMessage

      # 第五步：上传一个 APK 文件测试
      - name: Upload one APK
        run: |
          file=$(ls ./apk/release/*.apk | head -n 1)
          echo "准备上传测试文件: $file"
          ls -l $file
          curl -X POST \
            -F chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -F document=@$file \
            ${{ secrets.TELEGRAM_BOT_API_URL }}/sendDocument
