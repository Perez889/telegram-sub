name: APK to Telegram

on:
  workflow_dispatch:

jobs:
  push-apks:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ å®‰è£… git-lfsï¼ˆå…³é”®ï¼‰
      - name: Install git-lfs
        run: |
          sudo apt-get update
          sudo apt-get install -y git-lfs
          git lfs install

      # 2ï¸âƒ£ å…‹éš†ä»“åº“
      - name: Clone FongMi/Release
        run: |
          git clone https://github.com/FongMi/Release.git release_temp
          cd release_temp
          git lfs pull

      # 3ï¸âƒ£ æ ¡éªŒ APK æ˜¯å¦çœŸçš„å­˜åœ¨ï¼ˆä¸æ˜¯æŒ‡é’ˆï¼‰
      - name: Verify APK files
        run: |
          cd release_temp/apk/release || exit 1
          echo "APK æ–‡ä»¶åˆ—è¡¨ï¼š"
          ls -lh *.apk
          echo "æ–‡ä»¶ç±»å‹ï¼š"
          file *.apk

      # 4ï¸âƒ£ ä¸Šä¼  APK åˆ° Telegram
      - name: Upload APKs to Telegram
        env:
          BOT_API_URL: ${{ secrets.TELEGRAM_BOT_API_URL }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          cd release_temp/apk/release || exit 1

          for APK_FILE in *.apk; do
            echo "ä¸Šä¼  $APK_FILE ..."

            curl -X POST "$BOT_API_URL" \
              -F "chat_id=$CHAT_ID" \
              -F "document=@$APK_FILE" \
              -F "caption=ğŸ“¦ æ–‡ä»¶: $APK_FILE"

            echo "âœ… $APK_FILE ä¸Šä¼ å®Œæˆ"
          done
