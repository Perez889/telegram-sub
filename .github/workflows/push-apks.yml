name: APK to Telegram

on:
  workflow_dispatch:

jobs:
  push-apks:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ å®‰è£… git-lfs
      - name: Install git-lfs
        run: |
          sudo apt-get update
          sudo apt-get install -y git-lfs
          git lfs install

      # 2ï¸âƒ£ å…‹éš†ä»“åº“
      - name: Clone FongMi/Release
        run: |
          git clone https://github.com/FongMi/Release.git release_temp
          cd release_temp

          # âš ï¸ å…³é”®ä¸‰è¿ï¼ˆç¼ºä¸€ä¸å¯ï¼‰
          git lfs fetch --all
          git lfs pull
          git lfs checkout

      # 3ï¸âƒ£ éªŒè¯ APK æ˜¯å¦æ˜¯çœŸå®äºŒè¿›åˆ¶
      - name: Verify APK files
        run: |
          cd release_temp/apk/release || exit 1
          ls -lh *.apk
          echo "====== æ–‡ä»¶ç±»å‹ ======"
          file *.apk

      # 4ï¸âƒ£ ä¸Šä¼  APK
      - name: Upload APKs to Telegram
        env:
          BOT_API_URL: ${{ secrets.TELEGRAM_BOT_API_URL }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          cd release_temp/apk/release || exit 1

          for APK in *.apk; do
            echo "ğŸš€ ä¸Šä¼  $APK"

            curl --fail -X POST "$BOT_API_URL" \
              -F "chat_id=$CHAT_ID" \
              -F "document=@$APK" \
              -F "caption=ğŸ“¦ $APK"

            echo "âœ… $APK ä¸Šä¼ å®Œæˆ"
          done
