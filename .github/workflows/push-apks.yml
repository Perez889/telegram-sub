name: Push FongMi APKs to Telegram

on:
  workflow_dispatch:

jobs:
  push-apks:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Clone ä¸»ä»“åº“
      - name: Clone FongMi Release
        run: |
          git clone https://github.com/FongMi/Release.git release_temp

      # 2ï¸âƒ£ ä¸Šä¼  APK æ–‡ä»¶
      - name: Upload APKs to Telegram
        env:
          BOT_API_URL: ${{ secrets.TELEGRAM_BOT_API_URL }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          cd release_temp/apk/release || exit 1

          # ä¸´æ—¶è®°å½•å·²ä¸Šä¼  APK
          touch uploaded_apks.txt

          for APK_FILE in *.apk; do
            # æ£€æŸ¥æ˜¯å¦å·²ä¸Šä¼ 
            if grep -Fxq "$APK_FILE" uploaded_apks.txt; then
              echo "$APK_FILE å·²ä¸Šä¼ ï¼Œè·³è¿‡"
              continue
            fi

            TIMESTAMP=$(date -u +"%Y-%m-%d %H:%M UTC")

            echo "ä¸Šä¼  $APK_FILE ..."

            curl -X POST "$BOT_API_URL" \
                 -F "chat_id=$CHAT_ID" \
                 -F "document=@$APK_FILE" \
                 -F "caption=ðŸ“¦ æ–‡ä»¶: $APK_FILE\nðŸ•’ ä¸Šä¼ æ—¶é—´: $TIMESTAMP"

            echo "$APK_FILE ä¸Šä¼ å®Œæˆ"

            echo "$APK_FILE" >> uploaded_apks.txt
          done
